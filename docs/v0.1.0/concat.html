
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Concat · Daf.jl v0.1.0
</title>
<meta name="title" content="Concat · Daf.jl v0.1.0"/>
<meta property="og:title" content="Concat · Daf.jl v0.1.0"/>
<meta property="twitter:title" content="Concat · Daf.jl v0.1.0"/>
<meta name="description" content="Documentation for Daf.jl v0.1.0."/>
<meta property="og:description" content="Documentation for Daf.jl v0.1.0."/>
<meta property="twitter:description" content="Documentation for Daf.jl v0.1.0."/>
<script data-outdated-warner src="assets/warner.js">
</script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/>
<script>documenterBaseURL="."
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js">
</script>
<script src="search_index.js">
</script>
<script src="siteinfo.js">
</script>
<script src="../versions.js">
</script>
<link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/>
<link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/>
<script src="assets/themeswap.js">
</script>
</head>
<body>
<div id="documenter">
<nav class="docs-sidebar">
<a class="docs-logo" href="index.html">
<img src="assets/logo.svg" alt="Daf.jl v0.1.0 logo"/>
</a>
<div class="docs-package-name">
<span class="docs-autofit">
<a href="index.html">Daf.jl v0.1.0
</a>
</span>
</div>
<button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)
</button>
<ul class="docs-menu">
<li>
<a class="tocitem" href="index.html">Daf
</a>
</li>
<li>
<a class="tocitem" href="data.html">Data
</a>
</li>
<li>
<a class="tocitem" href="read_only.html">Read-only
</a>
</li>
<li>
<a class="tocitem" href="queries.html">Queries
</a>
</li>
<li>
<a class="tocitem" href="tokens.html">Tokens
</a>
</li>
<li>
<a class="tocitem" href="views.html">Views
</a>
</li>
<li>
<a class="tocitem" href="chains.html">Chains
</a>
</li>
<li>
<a class="tocitem" href="computations.html">Computations
</a>
</li>
<li>
<a class="tocitem" href="copies.html">Copies
</a>
</li>
<li class="is-active">
<a class="tocitem" href="concat.html">Concat
</a>
<ul class="internal">
<li>
<a class="tocitem" href="#Index">
<span>Index
</span>
</a>
</li>
</ul>
</li>
<li>
<a class="tocitem" href="adapters.html">Adapters
</a>
</li>
<li>
<a class="tocitem" href="contracts.html">Contracts
</a>
</li>
<li>
<a class="tocitem" href="formats.html">Formats
</a>
</li>
<li>
<a class="tocitem" href="memory_format.html">Memory Format
</a>
</li>
<li>
<a class="tocitem" href="h5df_format.html">H5DF Format
</a>
</li>
<li>
<a class="tocitem" href="files_format.html">Files Format
</a>
</li>
<li>
<a class="tocitem" href="anndata_format.html">AnnData Format
</a>
</li>
<li>
<a class="tocitem" href="registry.html">Operations registry
</a>
</li>
<li>
<a class="tocitem" href="operations.html">Query operations
</a>
</li>
<li>
<a class="tocitem" href="storage_types.html">Storage types
</a>
</li>
<li>
<a class="tocitem" href="matrix_layouts.html">Matrix layouts
</a>
</li>
<li>
<a class="tocitem" href="messages.html">Messages
</a>
</li>
<li>
<a class="tocitem" href="generic.html">Generic
</a>
</li>
<li>
<a class="tocitem" href="example_data.html">Example data
</a>
</li>
<li>
<a class="tocitem" href="todo.html">TODO
</a>
</li>
</ul>
<div class="docs-version-selector field has-addons">
<div class="control">
<span class="docs-label button is-static is-size-7">Version
</span>
</div>
<div class="docs-selector control is-expanded">
<div class="select is-fullwidth is-size-7">
<select id="documenter-version-selector">
</select>
</div>
</div>
</div>
</nav>
<div class="docs-main">
<header class="docs-navbar">
<a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#">
</a>
<nav class="breadcrumb">
<ul class="is-hidden-mobile">
<li class="is-active">
<a href="concat.html">Concat
</a>
</li>
</ul>
<ul class="is-hidden-tablet">
<li class="is-active">
<a href="concat.html">Concat
</a>
</li>
</ul>
</nav>
<div class="docs-right">
<a class="docs-navbar-link" href="https://github.com/tanaylab/Daf.jl/blob/main{path}?plain=1#L{line}" title="View the repository on GitHub">
<span class="docs-icon fa-brands">
</span>
<span class="docs-label is-hidden-touch">GitHub
</span>
</a>
<a class="docs-navbar-link" href="https://github.com/tanaylab/Daf.jl/blob/main/src/concat.md" title="Edit source on GitHub">
<span class="docs-icon fa-solid">
</span>
</a>
<a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings">
</a>
<a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings">
</a>
</div>
</header>
<article class="content" id="documenter-page">
<h1 id="Concat">
<a class="docs-heading-anchor" href="#Concat">Concat
</a>
<a id="Concat-1">
</a>
<a class="docs-heading-anchor-permalink" href="#Concat" title="Permalink">
</a>
</h1>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="Daf.Concat" href="#Daf.Concat">
<code>Daf.Concat
</code>
</a> — 
<span class="docstring-category">Module
</span>
</header>
<section>
<div>
<p>Concatenate multiple 
<code>Daf
</code> data sets along some axis. This copies the data from the concatenated data sets into some target data set.
</p>
<p>The exact behavior of concatenation is surprisingly complex when accounting for sparse vs. dense matrices, different matrix layouts, and properties which are not along the concatenation axis. The implementation is further complicated by minimizing the allocation of intermediate memory buffers for the data; that is, in principle, concatenating from and into memory-mapped data sets should not allocate &quot;any&quot; memory buffers - the data should be copied directly from one memory-mapped region to another.
</p>
</div>
<a class="docs-sourcelink" target="_blank" href="https://github.com/tanaylab/Daf.jl/blob/21885fe7bb92ba5826c60da8b6e7fe2226d8be06/src/concat.jl#L1-L10">source
</a>
</section>
</article>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="Daf.Concat.concatenate" href="#Daf.Concat.concatenate">
<code>Daf.Concat.concatenate
</code>
</a> — 
<span class="docstring-category">Function
</span>
</header>
<section>
<div>
<pre>
<code class="language-julia hljs">function concatenate(
    into::DafWriter,
    axis::Union{AbstractString, AbstractStringVector},
    from::AbstractVector{&lt;:DafReader};
    [names::Maybe{AbstractStringVector} = nothing,
    dataset_axis::Maybe{AbstractString} = &quot;dataset&quot;,
    dataset_property::Bool = true,
    prefix::Union{Bool, AbstractVector{Bool}} = false,
    prefixed::Maybe{Union{AbstractStringSet, AbstractVector{&lt;:AbstractStringSet}}} = nothing,
    empty::Maybe{EmptyData} = nothing,
    sparse_if_saves_storage_fraction = 0.25,
    merge::Maybe{MergeData} = nothing,
    overwrite::Bool = false]
)::Nothing
</code>
</pre>
<p>Concatenate data 
<code>from
</code> a sequence of 
<code>Daf
</code> data sets 
<code>into
</code> a single data set along one or more concatenation 
<code>axis
</code>. You can also concatenate along multiple axes by specifying an array of 
<code>axis
</code> names.
</p>
<p>We need a unique name for each of the concatenated data sets. By default, we use the 
<code>DafReader.name
</code>. You can override this by specifying an explicit 
<code>names
</code> vector with one name per data set.
</p>
<p>By default, a new axis named by 
<code>dataset_axis
</code> is created with one entry per concatenated data set, using these unique names. You can disable this by setting 
<code>dataset_axis
</code> to 
<code>nothing
</code>.
</p>
<p>If an axis is created, and 
<code>dataset_property
</code> is set (the default), a property with the same name is created for the concatenated 
<code>axis
</code>, containing the name of the data set each entry was collected from.
</p>
<p>The entries of each concatenated axis must be unique. By default, we require that no entry name is used in more than one data set. If this isn&#39;t the case, then set 
<code>prefix
</code> to specify adding the unique data set name (and a 
<code>.
</code> separator) to its entries (either once for all the axes, or using a vector with a setting per axis).
</p>
<div class="admonition is-info">
<header class="admonition-header">Note
</header>
<div class="admonition-body">
<p>If a prefix is added to the axis entry names, then it must also be added to all the vector properties whose values are entries of the axis. By default, we assume that any property name that is identical to the axis name is such a property (e.g., given a 
<code>cluster
</code> axis, a 
<code>cluster
</code> property of each 
<code>cell
</code> is assumed to contain the names of clusters from that axis). We also allow for property names to just start with the axis name, followed by 
<code>.
</code> and some suffix (e.g., 
<code>cluster.manual
</code> will also be assumed to contain the names of clusters). We&#39;ll automatically add the unique prefix to all such properties.
</p>
<p>If, however, this heuristic fails, you can specify a vector of properties to be 
<code>prefixed
</code> (or a vector of such vectors, one per concatenated axis). In this case only the listed properties will be prefixed with the unique data set names.
</p>
</div>
</div>
<p>Vector and matrix properties for the 
<code>axis
</code> will be concatenated. If some of the concatenated data sets do not contain some property, then an 
<code>empty
</code> value must be specified for it, and will be used for the missing data.
</p>
<p>Concatenated matrices are always stored in column-major layout where the concatenation axis is the column axis. There should not exist any matrices whose both axes are concatenated (e.g., square matrices of the concatenated axis).
</p>
<p>The concatenated properties will be sparse if the storage for the sparse data is smaller than naive dense storage by at 
<code>sparse_if_saves_storage_fraction
</code> (by default, if using sparse storage saves at least 25% of the space, that is, takes at most 75% of the dense storage space). When estimating this fraction, we assume dense data is 100% non-zero; we only take into account data already stored as sparse, as well as any missing data whose 
<code>empty
</code> value is zero.
</p>
<p>By default, properties that do not apply to any of the concatenation 
<code>axis
</code> will be ignored. If 
<code>merge
</code> is specified, then such properties will be processed according to it. Using 
<code>CollectAxis
</code> for a property requires that the 
<code>dataset_axis
</code> will not be 
<code>nothing
</code>.
</p>
<p>By default, concatenation will fail rather than 
<code>overwrite
</code> existing properties in the target.
</p>
</div>
<a class="docs-sourcelink" target="_blank" href="https://github.com/tanaylab/Daf.jl/blob/21885fe7bb92ba5826c60da8b6e7fe2226d8be06/src/concat.jl#L71-L132">source
</a>
</section>
</article>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="Daf.Concat.MergeData" href="#Daf.Concat.MergeData">
<code>Daf.Concat.MergeData
</code>
</a> — 
<span class="docstring-category">Type
</span>
</header>
<section>
<div>
<p>A vector of pairs where the key is a 
<a href="formats.html#Daf.Formats.DataKey">
<code>DataKey
</code>
</a> and the value is 
<a href="concat.html#Daf.Concat.MergeAction">
<code>MergeAction
</code>
</a>. Similarly to 
<a href="views.html#Daf.Views.ViewData">
<code>ViewData
</code>
</a>, the order of the entries matters (last one wins), and a key containing 
<code>&quot;*&quot;
</code> is expanded to all the relevant properties. For matrices, merge is done separately for each layout. That is, the order of the key 
<code>(rows_axis, columns_axis, matrix_name)
</code> key 
<em>does
</em> matter in the 
<code>MergeData
</code>, which is different from how 
<a href="views.html#Daf.Views.ViewData">
<code>ViewData
</code>
</a> works.
</p>
<div class="admonition is-info">
<header class="admonition-header">Note
</header>
<div class="admonition-body">
<p>Due to Julia&#39;s type system limitations, there&#39;s just no way for the system to enforce the type of the pairs in this vector. That is, what we&#39;d 
<strong>like
</strong> to say is:
</p>
<pre>
<code class="nohighlight hljs">MergeData = AbstractVector{Pair{DataKey, MergeAction}}
</code>
</pre>
<p>But what we are 
<strong>forced
</strong> to say is:
</p>
<pre>
<code class="nohighlight hljs">ViewData = AbstractVector
</code>
</pre>
<p>That&#39;s 
<strong>not
</strong> a mistake. Even 
<code>MergeData = AbstractVector{Pair}
</code> fails to work, as do all the (many) possibilities for expressing &quot;this is a vector of pairs where the key or the value can be one of several things&quot; Sigh. Glory to anyone who figures out an incantation that would force the system to perform 
<strong>any
</strong> meaningful type inference here.
</p>
</div>
</div>
</div>
<a class="docs-sourcelink" target="_blank" href="https://github.com/tanaylab/Daf.jl/blob/21885fe7bb92ba5826c60da8b6e7fe2226d8be06/src/concat.jl#L34-L53">source
</a>
</section>
</article>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="Daf.Concat.MergeAction" href="#Daf.Concat.MergeAction">
<code>Daf.Concat.MergeAction
</code>
</a> — 
<span class="docstring-category">Type
</span>
</header>
<section>
<div>
<p>The action for merging the values of a property from the concatenated data sets into the result data set. This is used to properties that do not apply to the concatenation axis (that is, scalar properties, and vector and matrix properties of other axes). Valid values are:
</p>
<ul>
<li>
<code>SkipProperty
</code> - do not create the property in the result. This is the default.
</li>
<li>
<code>LastValue
</code> - use the value from the last concatenated data set (that has a value for the property). This is useful for properties that have the same value for all concatenated data sets.
</li>
<li>
<code>CollectAxis
</code> - collect the values from all the data sets, adding a dimension to the data (that is, convert a scalar property to a vector, and a vector property to a matrix). This can&#39;t be applied to matrix properties, because we can&#39;t directly store 3D data inside 
<code>Daf
</code>. In addition, this requires that a dataset axis is created in the target, and that an empty value is specified for the property if it is missing from any of the concatenated data sets.
</li>
</ul>
</div>
<a class="docs-sourcelink" target="_blank" href="https://github.com/tanaylab/Daf.jl/blob/21885fe7bb92ba5826c60da8b6e7fe2226d8be06/src/concat.jl#L56-L68">source
</a>
</section>
</article>
<h2 id="Index">
<a class="docs-heading-anchor" href="#Index">Index
</a>
<a id="Index-1">
</a>
<a class="docs-heading-anchor-permalink" href="#Index" title="Permalink">
</a>
</h2>
<ul>
<li>
<a href="concat.html#Daf.Concat">
<code>Daf.Concat
</code>
</a>
</li>
<li>
<a href="concat.html#Daf.Concat.MergeAction">
<code>Daf.Concat.MergeAction
</code>
</a>
</li>
<li>
<a href="concat.html#Daf.Concat.MergeData">
<code>Daf.Concat.MergeData
</code>
</a>
</li>
<li>
<a href="concat.html#Daf.Concat.concatenate">
<code>Daf.Concat.concatenate
</code>
</a>
</li>
</ul>
</article>
<nav class="docs-footer">
<a class="docs-footer-prevpage" href="copies.html">« Copies
</a>
<a class="docs-footer-nextpage" href="adapters.html">Adapters »
</a>
<div class="flexbox-break">
</div>
<p class="footer-message">Powered by 
<a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl
</a> and the 
<a href="https://julialang.org/">Julia Programming Language
</a>.
</p>
</nav>
</div>
<div class="modal" id="documenter-settings">
<div class="modal-background">
</div>
<div class="modal-card">
<header class="modal-card-head">
<p class="modal-card-title">Settings
</p>
<button class="delete">
</button>
</header>
<section class="modal-card-body">
<p>
<label class="label">Theme
</label>
<div class="select">
<select id="documenter-themepicker">
<option value="auto">Automatic (OS)
</option>
<option value="documenter-light">documenter-light
</option>
<option value="documenter-dark">documenter-dark
</option>
</select>
</div>
</p>
<hr/>
<p>This document was generated with 
<a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl
</a> version 1.3.0. Using Julia version 1.10.2.
</p>
</section>
<footer class="modal-card-foot">
</footer>
</div>
</div>
</div>
</body>
</html>
